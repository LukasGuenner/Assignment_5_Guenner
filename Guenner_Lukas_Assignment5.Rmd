---
title: "DSPM - Assignment 5"
author: 'Submitted by Lukas GÃ¼nner (Student-ID: 5393972)'
date: "02/10/2021"
output: 
  html_document:
    toc: True
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Working directory:
# Load project to obtain correct working directory

```
I worked together with Max Haberl (Student ID: 5407084). I hereby assure that my submission is in line with the *Code of Conduct* outlined on the lecture slides.

The working history for this assignment can be accessed via this link:

https://github.com/LukasGuenner/Assignment_5_Guenner.git


## Preparation

Before starting this assignment, I am clearing my workspace and console and then 
loading the packages, necessary to complete this assignment. 
```{r prep, message=FALSE}

rm(list = ls()); cat("\014")

library(tidyverse)
library(naniar)
library(dplyr)

```

## Getting to know the API

read documentation of the ticketmaster.com API

```{r key, message=F}

# loading API key from separate file 
source("ticketmasterKey.R")

```

Information on the API:

ATTENTION !!!
5000 API calls per day and rate limitation of 5 requests per second!
Deep Paging: we only support retrieving the 1000th item. i.e. ( size * page < 1000)

```{r key, message=F}

# information from the API documentation
root <- "https://app.ticketmaster.com/discovery/v2/"

```


## Interaction with the API - the basics


```{r libraries, message=F}

# loading required packages
if (!require("jsonlite")) install.packages("jsonlite")
if (!require("httr")) install.packages("httr")
if (!require("rlist")) install.packages("rlist")

library(jsonlite)
library(httr)
library(rlist)

```


Making the first API call to obtain venues in Germany

```{r basics, message=F}

country <- "DE"  # define country

# perform GET request
venuesResp <- GET(paste0(root, "venues?apikey=", mykey, 
                     "&locale=*&countryCode=", country)) %>%
  content()

# describe what you can see from the list obtained after the request


# subset list to venue data
subset <- venuesResp[["_embedded"]][["venues"]]

# initialize data frame to store information
venues <- data.frame(name = character(),
                     city = character(), 
                     adress = character(),
                     postalCode = integer(),
                     countryCode = character(),
                     url = character(),
                     longitude = numeric(),
                     latitude = numeric(),
                     stringsAsFactors=FALSE)

# extract data from list
for (i in 1:20){
  name <- subset[[i]]$name
  city <- subset[[i]]$city$name
  address <- subset[[i]]$address$line1
  postalCode <- subset[[i]]$postalCode
  countryCode <- subset[[i]]$country$countryCode
  url <- subset[[i]]$url
  longitude <- subset[[i]]$location$longitude
  latitude <- subset[[i]]$location$latitude
  
  venues[i, ] <- c(name, city, address, postalCode, countryCode, url, 
                   longitude, latitude)
}

```





```{r key, message=F}



```








